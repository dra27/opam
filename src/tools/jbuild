(jbuild_version 1)

(executable
  ((name opam_admin_topstart)
   (modules (opam_admin_top opam_admin_topstart))
   (ocamlc_flags (:standard (:include ../ocaml-flags-standard.sexp) (:include ../ocaml-context-flags.sexp) -linkall))
   (libraries (opam-client opam-file-format compiler-libs.toplevel re.glob))))

(rule (with-stdout-to opam_admin_topstart.ml (echo "include Opam_admin_top\n\nlet _ = Topmain.main ()")))

(install
  ((section bin)
   (package opam-admin)
   (files ((opam_admin_topstart.bc as opam-admin.top)))))
(install
  ((section lib)
   (package opam-admin)
   (files (opam_admin_top.cmi))))

(executable
  ((name opam_check)
   (modules (opam_check))
   (flags (:standard (:include ../ocaml-flags-standard.sexp) (:include ../ocaml-context-flags.sexp)))
   (libraries (opam-state))))

(include opam-putenv.inc)

(executable
  ((name opam_installer)
   (package opam-installer)
   (public_name opam-installer)
   (modules (opam_installer))
   (libraries (opam-format cmdliner))
   (flags (:standard (:include ../ocaml-flags-standard.sexp) (:include ../ocaml-context-flags.sexp)))))
